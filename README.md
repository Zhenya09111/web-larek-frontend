# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных испульзуемые в приложении 

карточка продукта

```
interface IProduct { 
     description: string;
     image: string;
     title: string;
     category: string;
     price: number;
     id: string;
}
```

данные о заказе
```
interface IOrder{
    payment: string;
    address: string;
    email: string;
    phone: string;
    items: string[] | string; 
    total: number | string;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слои данных

#### Класс ProductData

Класс отвечает за хранение товаров и логику работы с данными этих товаровю.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _products: массив объектов товаров 
- _basket: массив товеров в корзине
- order: объект заказа 
- formErrors: объект ошибок 

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addItemBasket(par: IProduct): void - добавляет карточку в начало массива для корзины
- deleteItemBasket(itemId: string) - удаляет карточку из массива для корзины
- getProduct(productId: string) - получает карточку по id 
- selected(item: string): boolean - проверка существования карточки в массиве для корзины
- setOrderField(field: keyof IOrder, value: string): void - сохранине введеных значений в поля формы в объекс заказа 
- validateOrderAddress(): boolean - проверка количества символов в поле формы 
- validOrderContacts(): boolean - проверка количества символов в полях формы
-payment(value: string): void - сохранение способа оплаты для объекта заказа
- setPriceOrder(): void - сохранение конечно цены всех товаров корзины в объекте заказа 
- setItemOrder(value: IProduct[]): void - сохранение id всех товаров в корзине в объект заказа
- orderReset(): void - сброс всех данных заказа 
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий
- render(data: IModalData): HTMLElement - принимает разметку которую будет отображать в модальном окне 

#### Класс Product
Класс твечает за отображение карточки товара на странице, задавая в ней категорию, название, цену, изображение.В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.

#### Класс ProdcutPreview
Класс отвечает за отображение модальнго окна выбранной пользователем карточки, задавая в ней изображение, цену, описание и категорию.В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.\
методы:
- сеттер checkDisabled проверяет наличие карточки в корзине и блокирует кнопку, если она была уже выбрана 

#### Класс Page 
Класс отвечает за отображение основного всего основного контента на станице: вывод всех карточек на странице, управление кнопкной корзины и отображение количества товаров в ней.\
Методы:
- сеттер counter отображает количество товаров в корзине 
- сеттер catalog отображает все полученные разметки товаров 
- сеттер locked отвчает за блокировку прокрутки страницы 

#### Класс BasketItem
Класс отвечает за отображение карточки в корзине. Показывая в ней название, цену. В конструктор класса передается DOM элемент темплейта и порядковый номер в массиве для отображения в разметке. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.

#### Класс Basket
Класс отвечает за отображение всей корзины. Показывая в ней список выбранных в корзину товаров. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.

#### Класс AddressForm 
Класс отвечает за отображения формы заказа, в ней выбирается способ оплаты и заполняется адрес заказа.В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.\
Методы: 
- сеттер inputValues(data: Record<string, string>) - принимает объет с значениям полей вводы в форме
- метод buttonValue(field: string) - сохраняем выбранные способ оплаты 
- метод onInputChange(field: keyof IOrder, value: string) - получаем значения полей веденных пользователем 
- метод сheckButton(valid: boolean) - метод разблокирующий кнопку, если поля формы были заполнены корректно 

#### Класс ContactsForm
Класс отображает прододжение формы заполнения заказа. В этой форме заполняются номер и email заказчика.В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.\
Методы: 
- метод onInputChange(field: keyof IOrder, value: string) - получаем значения полей веденных пользователем 
- метод сheckButton(valid: boolean) - метод разблокирующий кнопку, если поля формы были заполнены корректно 
- сеттер inputValues(data: Record<string, string>) - принимает объет с значениям полей вводы в форме

#### Класс SuccessFrom
Класс отображает модальное окно после успешной отправки заказа, показывая общую цену покупки. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.\
- ceттер description - показывает сумму списания за всю покупку 

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

- `product:select` - открытие модального окна карточки 
- `'modal:open` - блокировка прокрутки страницы при открытии модально окна
- `modal:close` - открытие прокрутки страницы после закрытия модального окна
- `product add basket` - добавление товара в корзину
- `delete:product` - удаление товара из корзины 
- `basket:open` - открытие корзины 
- `address:open` - открытие модального окна с формой заказа 
